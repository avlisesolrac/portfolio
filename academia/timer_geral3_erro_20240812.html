<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercícios</title>
    <style>
        li {
            padding: 10px;
        }
        .completed {
            text-decoration: line-through;
            color: grey;
        }
        .timer {
            font-size: 0.9em;
            color: lightseagreen;
            margin-left: 10px;
        }
        .skip-button {
            margin-left: 10px;
            font-size: 0.8em;
            padding: 3px 6px;
            display: none;
            background-color: #008CBA;
            border: 1px solid black;
            cursor: pointer;
        }
        .disabled {
            pointer-events: none;
            opacity: 0.6;
        }
        .active-group {
            font-weight: bold;
            border: 2px solid #008CBA;
        }
        .exercise-list input[type="checkbox"] {
            transform: scale(1.5);
            margin-left: 10px;
        }
        .exercise-list input[type="number"] {
            font-size: 1.2em;
            width: 60px;
            margin-left: 10px;
        }
        button {
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        }
        .button_timer {
            background-color: #008CBA;
        }
        div{width: 370px}
        .hidden { 
            display: none; 
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <h1>Gerenciamento dos Treinos da Academia</h1>
    <p>O objetivo desta aplicação é que eu possa fazer os treinos da academia com o acompanhamento gerenciado por esta aplicação</p>
    <p>Será utilizado como base o app Treino utilizado na época em que eu treinava na academia Ironberg de São Caetano do Sul</p>

    <ul id="fichas">
        <li data-ficha-id="fichaA">Ficha A - Última execução: <span id="lastExecutionA">N/A</span></li>
        <li data-ficha-id="fichaB">Ficha B - Última execução: <span id="lastExecutionB">N/A</span></li>
        <li data-ficha-id="fichaC">Ficha C - Última execução: <span id="lastExecutionC">N/A</span></li>
        <li data-ficha-id="fichaD">Ficha D - Última execução: <span id="lastExecutionD">N/A</span></li>
    </ul>

    <button id="startButton" onclick="startExercises()" class="button_timer">Iniciar Treino</button>
    <span id="generalTimer" class="timer" style="display: none;"></span>
    
    <!-- FICHA A - INÍCIO -->
    <h1 class="exercise-section" data-group-id="fichaA">Ficha A - Treino de Peito, Triceps e Ombro</h1>
    <ol id="exerciseList">
        <li>Supino Reto</li>
        <li>Crucifixo Declinado</li>
        <li>Crucifixo Inclinado</li>
        <li>Desenvolvimento - Ombros</li>
        <li>Triceps Cross(barra W)</li>
        <li>Triceps Francês</li>
        <li>Triceps Coice Cross</li>
        <li>Elevação Lateral</li>
        <li>Elevação Lateral - Sentado</li>
        <li>Encolhimento - Trapézio</li>
    </ol>

    <div class="exercise-group" data-group-id="supinoReto" onclick="tryActivateGroup('supinoReto')">
        <h1>Supino Reto<button class="skip-button" onclick="skipTimer(this)">Pular</button></h1>
        <img src="imagens/supino-reto.webp" alt="">
        <ol class="exercise-list disabled">
            <li><label><i class="fas fa-dumbbell"></i> <input type="number" value="20" onchange="saveWeight('supinoReto', 0, this.value)"><input type="checkbox" onclick="toggleCompleted(this)"/></label><span class="timer"></span></li>
            <li><label><i class="fas fa-dumbbell"></i> <input type="number" value="20" onchange="saveWeight('supinoReto', 1, this.value)"><input type="checkbox" onclick="toggleCompleted(this)"/></label><span class="timer"></span></li>
            <li><label><i class="fas fa-dumbbell"></i> <input type="number" value="20" onchange="saveWeight('supinoReto', 2, this.value)"><input type="checkbox" onclick="toggleCompleted(this)"/></label><span class="timer"></span></li>
            <li><label><i class="fas fa-dumbbell"></i> <input type="number" value="20" onchange="saveWeight('supinoReto', 3, this.value)"><input type="checkbox" onclick="toggleCompleted(this)"/></label><span class="timer"></span></li>
        </ol>
    </div>

<!-- FICHA A - FIM -->

<!-- FICHA B - INÍCIO -->
    <h1 class="exercise-section" data-group-id="fichaB">Ficha B - Quadriceps, Gluteos e Abdominal</h1>
    <ol>
        <li>Leg Press 45º</li>
        <li>Agachamento Pendulo</li>
        <li>Afundo Smith</li>
        <li>Elevação Pelvica</li>
        <li>Cadeira Abdutora</li>
        <li>Abdominal 1</li>
        <li>Abdominal 2</li>
    </ol>

    <div class="exercise-group" data-group-id="agachamentoPendulo" onclick="tryActivateGroup('agachamentoPendulo')">
        <h1>Agachamento Pendulo<button class="skip-button" onclick="skipTimer(this)">Pular</button></h1>
        <img src="imagens/agachamento-pendulo.gif" alt="">
        <ol class="exercise-list disabled">
            <li><label><i class="fas fa-dumbbell"></i> <input type="number" value="15" onchange="saveWeight('agachamentoPendulo', 0, this.value)"><input type="checkbox" onclick="toggleCompleted(this)"/></label><span class="timer"></span></li>
            <li><label><i class="fas fa-dumbbell"></i> <input type="number" value="15" onchange="saveWeight('agachamentoPendulo', 1, this.value)"><input type="checkbox" onclick="toggleCompleted(this)"/></label><span class="timer"></span></li>
            <li><label><i class="fas fa-dumbbell"></i> <input type="number" value="15" onchange="saveWeight('agachamentoPendulo', 2, this.value)"><input type="checkbox" onclick="toggleCompleted(this)"/></label><span class="timer"></span></li>
            <li><label><i class="fas fa-dumbbell"></i> <input type="number" value="15" onchange="saveWeight('agachamentoPendulo', 3, this.value)"><input type="checkbox" onclick="toggleCompleted(this)"/></label><span class="timer"></span></li>
        </ol>
    </div>
<!-- FICHA B - FIM -->

    <button id="endButton" class="button_timer" onclick="endGeneralTimer()" style="display: none;">Terminar Treino</button>

    <script>
        let activeSeriesTimer = null;
        let generalTimerInterval = null;
        let elapsedTime = 0;
        let currentTimerSpan = null;
        let currentCheckbox = null;
        let currentGroup = null;
        let exercisesStarted = false; // Flag para indicar se os exercícios foram iniciados

        document.addEventListener("DOMContentLoaded", () => {
            loadWeights();
            loadLastExecutionDates(); // Carrega e exibe as datas de última execução
            showCurrentFicha(); // Exibe a ficha atual
        });

        function loadLastExecutionDates() {
            const fichas = ['fichaA', 'fichaB', 'fichaC', 'fichaD'];
            fichas.forEach(fichaId => {
                const lastExecution = localStorage.getItem(`${fichaId}_lastExecution`) || 'N/A';
                document.getElementById(`lastExecution${fichaId.slice(-1)}`).textContent = lastExecution;
            });
        }

        function saveLastExecutionDate(fichaId) {
            const currentDate = new Date().toLocaleDateString();
            localStorage.setItem(`${fichaId}_lastExecution`, currentDate);
            document.getElementById(`lastExecution${fichaId.slice(-1)}`).textContent = currentDate;

            updateCurrentFicha(fichaId); // Atualiza para a próxima ficha
        }

        function saveWeight(exerciseGroup, setIndex, weight) {
            localStorage.setItem(`weight_${exerciseGroup}_set${setIndex}`, weight);
        }

        function loadWeights() {
            const inputs = document.querySelectorAll('.exercise-list input[type="number"]');
            inputs.forEach(input => {
                const [exerciseGroup, setIndex] = input.name.split('_');
                const storedWeight = localStorage.getItem(`weight_${exerciseGroup}_set${setIndex}`);
                if (storedWeight) {
                    input.value = storedWeight;
                }
            });
        }

        function startGeneralTimer() {
            document.getElementById('generalTimer').style.display = 'inline';
            document.getElementById('endButton').style.display = 'inline';
            generalTimerInterval = setInterval(() => {
                elapsedTime++;
                document.getElementById('generalTimer').textContent = `Tempo Total: ${Math.floor(elapsedTime / 60)}m ${elapsedTime % 60}s`;
            }, 1000);
        }

        function endGeneralTimer() {
            clearInterval(generalTimerInterval);
            document.getElementById('generalTimer').style.display = 'none';
            document.getElementById('endButton').style.display = 'none';
            if (confirm("Deseja salvar a data da última execução para esta ficha?")) {
                const currentFicha = localStorage.getItem('currentFicha') || 'fichaA';
                saveLastExecutionDate(currentFicha);
            }
        }

        function startExercises() {
            exercisesStarted = true;
            startGeneralTimer();
            tryActivateGroup(currentGroup || 'supinoReto');
            document.getElementById("startButton").style.display = 'none';
        }

        function tryActivateGroup(groupId) {
            if (!exercisesStarted) return; // Se os exercícios ainda não foram iniciados, não faz nada
            if (currentGroup && currentGroup !== groupId) {
                const previousGroupElement = document.querySelector(`.exercise-group[data-group-id="${currentGroup}"] .exercise-list`);
                if (previousGroupElement && previousGroupElement.classList.contains('disabled')) {
                    alert('Por favor, complete a série atual antes de passar para outra.');
                    return;
                }
            }
            activateGroup(groupId);
        }

        function activateGroup(groupId) {
            const groupElement = document.querySelector(`.exercise-group[data-group-id="${groupId}"] .exercise-list`);
            const allGroups = document.querySelectorAll('.exercise-list');
            allGroups.forEach(group => group.classList.add('disabled'));
            groupElement.classList.remove('disabled');
            currentGroup = groupId;

            const groupHeader = document.querySelector(`.exercise-group[data-group-id="${groupId}"] h1`);
            groupHeader.scrollIntoView({ behavior: 'smooth' });

            const allSections = document.querySelectorAll('.exercise-section');
            allSections.forEach(section => section.classList.remove('active-group'));
            groupHeader.closest('.exercise-section').classList.add('active-group');

            // Ocultar o botão "Pular" no início
            const skipButton = groupHeader.querySelector('.skip-button');
            skipButton.style.display = 'none';
        }

        function toggleCompleted(checkbox) {
            const listItem = checkbox.closest('li');
            const checkboxList = checkbox.closest('ol').querySelectorAll('input[type="checkbox"]');
            listItem.classList.toggle('completed');
            currentCheckbox = checkbox;

            if (checkbox.checked) {
                startSeriesTimer();
            } else {
                clearTimeout(activeSeriesTimer);
                currentTimerSpan.textContent = '';
            }

            const allChecked = Array.from(checkboxList).every(cb => cb.checked);
            if (allChecked) {
                const skipButton = checkbox.closest('.exercise-group').querySelector('.skip-button');
                if (skipButton) {
                    skipButton.style.display = 'inline';
                }
            }
        }

        function startSeriesTimer() {
            let seconds = 0;
            currentTimerSpan = currentCheckbox.closest('label').querySelector('.timer');
            currentTimerSpan.textContent = `Descanso: ${seconds}s`;

            activeSeriesTimer = setInterval(() => {
                seconds++;
                currentTimerSpan.textContent = `Descanso: ${seconds}s`;
            }, 1000);
        }

        function skipTimer(button) {
            clearInterval(activeSeriesTimer);
            currentTimerSpan.textContent = '';

            const nextGroup = getNextGroup(currentGroup);
            if (nextGroup) {
                tryActivateGroup(nextGroup);
            } else {
                endGeneralTimer();
                alert('Todos os exercícios da ficha foram concluídos!');
            }
        }

        function getNextGroup(groupId) {
            const allGroups = Array.from(document.querySelectorAll('.exercise-group'));
            const currentIndex = allGroups.findIndex(group => group.dataset.groupId === groupId);
            if (currentIndex >= 0 && currentIndex < allGroups.length - 1) {
                return allGroups[currentIndex + 1].dataset.groupId;
            }
            return null;
        }

        // Funções para controlar a exibição das fichas
        function showCurrentFicha() {
            const fichas = ['fichaA', 'fichaB', 'fichaC', 'fichaD'];
            let currentFicha = localStorage.getItem('currentFicha') || 'fichaA';

            fichas.forEach(fichaId => {
                const fichaElement = document.querySelector(`[data-ficha-id="${fichaId}"]`);
                const exerciseSection = document.querySelector(`.exercise-section[data-group-id="${fichaId}"]`);

                if (fichaId === currentFicha) {
                    fichaElement.style.display = 'list-item';
                    exerciseSection.style.display = 'block';
                } else {
                    fichaElement.style.display = 'none';
                    exerciseSection.style.display = 'none';
                }
            });
        }

        function updateCurrentFicha(fichaId) {
            const fichas = ['fichaA', 'fichaB', 'fichaC', 'fichaD'];
            let nextFichaIndex = (fichas.indexOf(fichaId) + 1) % fichas.length;
            localStorage.setItem('currentFicha', fichas[nextFichaIndex]);
            showCurrentFicha();
        }
    </script>
</body>
</html>
